<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>LED On/Off</title>
 	<style>
 		html,body{height:100%;margin:0;font-family:Segoe UI,Roboto,Arial,sans-serif;}
 		body{display:flex;align-items:center;justify-content:center;background:#fff;}
 		.container{text-align:center;padding:12px}
 		.led-img{max-width:320px;width:80vw;height:auto;display:block;margin:0 auto;user-select:none}
 		.led-button{border:0;background:transparent;padding:0;cursor:pointer}
 		.status{margin-top:12px;font-weight:600}
 	</style>
</head>
<body>
 	<div class="container">
 		<h1 id="title">Secuencia</h1>
 		<button id="led-toggle" class="led-button" aria-label="Trigger sequence" title="Trigger sequence">
 			<img id="led-img" class="led-img" src="button.png" alt="Trigger" draggable="false">
 		</button>

 		<div class="status"><strong id="state-text"></strong></div>
 	</div>

 	<script>
 		(function(){
 			const btn = document.getElementById('led-toggle');
 			const img = document.getElementById('led-img');
 			const stateText = document.getElementById('state-text');

 			const BUTTON_IMG = 'button.png';
 			const SERVER_IP = '192.168.100.80';

 			let isRunning = false;

 			function updateUI(message){
 				stateText.textContent = message || 'Invertir direcci√≥n';
 			}

 			async function trigger(e){
 				console.log('[DEBUG] Button clicked!');
 				if(e && typeof e.preventDefault === 'function') e.preventDefault();
 				
 				if(isRunning) {
 					console.log('[DEBUG] Sequence already running, ignoring click');
 					return;
 				}
 				
 				isRunning = true;
 				stateText.textContent = 'Ejecutando...';
 				
 				const url = `http://${SERVER_IP}/sequence`;
 				console.log('[DEBUG] Sending request to:', url);
 				try{
 					const response = await fetch(url);
 					console.log('[DEBUG] Response received - Status:', response.status, '- OK:', response.ok);
 					if(response.ok){
 						const responseText = await response.text();
 						console.log('[DEBUG] Response text:', responseText);
 						updateUI(responseText);
 					} else {
 						console.error('[ERROR] Response not OK - Status:', response.status);
 						updateUI('Error!');
 					}
 				}catch(err){
 					console.error('[ERROR] Failed to trigger sequence:', err);
 					console.error('[ERROR] Make sure SERVER_IP is correct:', SERVER_IP);
 					console.error('[ERROR] Make sure ESP32 is running and connected to WiFi');
 					updateUI('Error - Ver consola');
 				} finally {
 					isRunning = false;
 				}
 			}

 			btn.addEventListener('click', trigger);

 			updateUI();
 		})();
 	</script>
</body>
</html>